imports:
    - {resource: common.yml}

parameters:
    # Redefining default field type classes with the implementation that defines the type
    # as searchable. Needed in order to test searching wiht Solr engine.
    ezpublish.fieldType.ezfloat.class: eZ\Publish\API\Repository\Tests\FieldType\SearchableFloat
    ezpublish.fieldType.ezimage.class: eZ\Publish\API\Repository\Tests\FieldType\SearchableImage
    ezpublish.fieldType.ezmedia.class: eZ\Publish\API\Repository\Tests\FieldType\SearchableMedia
    ezpublish.fieldType.ezurl.class: eZ\Publish\API\Repository\Tests\FieldType\SearchableUrl
    languages:
        - eng-US
        - eng-GB
    ignored_storage_files:
        -
            var/ezdemo_site/storage/images/design/plain-site/172-2-eng-US/eZ-Publish-Demo-Design-without-demo-content1.png
    ezpublish.solr.endpoint.class: EzSystems\EzPlatformSolrSearchEngine\Gateway\Endpoint

    ez_search_engine_solr.connections:
        default:
            entry_endpoints:
                - endpoint0
            mapping:
                default: shard2
                translations:
                    eng-GB: shard3
                main_translations: shard0

#    ezpublish.search.solr.entry_endpoints:
#          - endpoint0
#    ezpublish.search.solr.cluster_endpoints:
#          eng-GB: shard3
#    ezpublish.search.solr.default_endpoint: shard2
#    ezpublish.search.solr.main_translations_endpoint: shard0

    ezpublish.api.repository_configuration_provider.class: EzSystems\EzPlatformSolrSearchEngine\Tests\SetupFactory\RepositoryConfigurationTestProvider

#    ezpublish.solr.engine_factory.class: EzSystems\EzPlatformSolrSearchEngineBundle\ApiLoader\SolrEngineFactory
#    ez_search_engine_solr.default_connection: 'default'

services:
    ezpublish.spi.search_engine:
        alias: ezpublish.spi.search.solr

    ezpublish.search.solr.endpoint.endpoint0:
        class: "%ezpublish.solr.endpoint.class%"
        arguments:
            -
                scheme: http
                host: solrcloud
                port: 8983
                path: /solr
                core: ezplatform
        tags:
            - {name: ezpublish.search.solr.endpoint, alias: endpoint0}

    ezpublish.api.repository_configuration_provider:
        class: "%ezpublish.api.repository_configuration_provider.class%"
        arguments:
            - "solrcloud"

#    ezpublish.solr.engine_factory:
#        class: "%ezpublish.solr.engine_factory.class%"
#        arguments:
#            - "@ezpublish.api.repository_configuration_provider"
#            - "%ez_search_engine_solr.default_connection%"
#            - "%ezpublish.spi.search.solr.class%"
#        calls:
#            - [setContainer, ["@service_container"]]
